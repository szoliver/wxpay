(function(a,x){var v=function(c,f){if(c&&f){c=c.split(".");f=f.split(".");for(var k=Math.min(c.length,f.length),d=0,g=0;d<k&&0==(g=parseInt(c[d])-parseInt(f[d]));)d++;g=0!=g?g:c.length-f.length;return 0<g}return!1};a.fn.wxPay=function(c,f,k,d,g,l,n){var e=!1,q=a.extend({},{pid:"0",desc:"\u652f\u4ed8\u8d39\u7528"},k);k=function(){e=!0};"undefined"==typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",k,!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",
k),document.attachEvent("onWeixinJSBridgeReady",k)):e=!0;var w=function(b){var m=0;b=b.toString();try{m+=b.split(".")[1].length}catch(r){}try{m+=(void 0).length}catch(r){}return Number(b.replace(".",""))*Number("100".replace(".",""))/Math.pow(10,m)};a(document).on("success",g);a(document).on("fail",l);a(document).on("cancel",n);if(a.isEmptyObject(f)&&!a.fn.wxPay.Debug)a(this).click(function(){alert("\u7528\u6237\u4fe1\u606f\u9519\u8bef\uff0c\u65e0\u6cd5\u8c03\u7528\u5fae\u4fe1\u652f\u4ed8")}),a(this).click();
else{var t=a.fn.wxPay.WxVersion();if(v(t,"8.0.3")||a.fn.wxPay.Debug)if(""==q.desc)q.desc="\u5907\u6ce8\u4e0d\u80fd\u4e3a\u7a7a";else{var p=!0;a(this).click(function(){if(p)if(p=!1,e||a.fn.wxPay.Debug){var b=0;if("function"===typeof d){b=d();if(isNaN(b)){p=!0;return}b=0<parseFloat(b)?w(b).toFixed(0):b}"number"!==typeof d||isNaN(d)||(b=w(d).toFixed(0));if(0!=b){var m=0,r="";a.post(c,{openid:f,tfee:b,body:q.desc,pid:q.pid,param:a.fn.wxPay.OrderParam,sp_billno:a.fn.wxPay.OrderCode},function(h){"ERROR"==
h.paySign?"function"===typeof l&&l(h.package):(m=h.payFee/100,r=h.mchOrder,WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:h.appId,timeStamp:h.timeStamp,nonceStr:h.nonceStr,"package":h.package,signType:"MD5",paySign:h.paySign},function(u){"get_brand_wcpay_request:ok"==u.err_msg?"function"===typeof g&&a(document).trigger("success",{fee:m,ordercode:r}):"get_brand_wcpay_request:fail"==u.err_msg?"function"===typeof l&&a(document).trigger("fail",u.err_desc):"function"===typeof n&&a(document).trigger("cancel",
h.payNo)}))},"json")}setTimeout(function(){p=!0},800)}else p=!0})}else a(this).click(function(){alert("\u8bf7\u5b89\u88c5\u5e76\u5347\u7ea7\u5fae\u4fe1APP\uff0c\u7248\u672c>=8.0.3\uff0c\u5f53\u524d\uff1a"+("0"==t?"\u975e\u5fae\u4fe1\u6d4f\u89c8\u5668":t))}),a(this).click()}};a.fn.SelectAddress=function(c,f,k,d,g,l,n){v(ver,"8.0.3")||a.fn.wxPay.Debug?a(this).click(function(){WeixinJSBridge.invoke("editAddress",{appId:c,scope:"jsapi_address",signType:"sha1",addrSign:f,timeStamp:k,nonceStr:d},function(e){"edit_address:ok"==
e.err_msg?a.isFunction(g)&&(a.fn.wxPay.SelectedAddr=e.proviceFirstStageName+" "+e.addressCitySecondStageName+" "+e.addressCountiesThirdStageName+" "+e.addressDetailInfo,g(e)):"edit_address:fail"==e.err_msg?a.isFunction(l)&&l(e.err_desc):a.isFunction(n)&&n("\u7528\u6237\u53d6\u6d88")})}):alert("\u8bf7\u5b89\u88c5\u5e76\u5347\u7ea7\u5fae\u4fe1APP\uff0c\u7248\u672c>=8.0.3\uff0c\u5f53\u524d\uff1a"+("0"==ver?"\u975e\u5fae\u4fe1\u6d4f\u89c8\u5668":ver))};a.fn.wxPay.SelectedAddr="";a.fn.wxPay.OrderParam=
"";a.fn.wxPay.OrderCode="";a.fn.wxPay.Debug=!1;a.fn.wxPay.WxVersion=function(){var c=navigator.userAgent.match(/MicroMessenger\/([\d\.]+)/i);return c?c[1]:"0"}})(jQuery,window);
